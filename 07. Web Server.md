## Set up Web Server

1. Buat file nginx.ini di directory .secret

   ![image](https://user-images.githubusercontent.com/40049149/192828757-9ca0cb5d-40aa-46bd-9b87-ea6594f2c633.png)

2. Ke Cloudflare copy api token kalian

   ![image](https://user-images.githubusercontent.com/40049149/192828369-b88f8628-cef9-4b36-bf49-1fd5d29ba0db.png)

3. Pastekan ke file nginx.ini

   ![image](https://user-images.githubusercontent.com/40049149/192828801-333d40b5-c33a-4722-ae13-cf1c1b23de62.png)

4. Jalankan Perintah berikut

       chmod 600 .secret/nginx..ini

## Buat Script Ansible

1. Buat file app

       server {
          server_name frenky.studentdumbways.my.id;

          location / {
             proxy_pass http://103.187.147.155:3000;
          }
       }

2. Buat file api

       server {
          server_name api.frenky.studentdumbways.my.id;

          location / {
             proxy_pass http://103.187.147.155:5000;
          }
       }

3. Buat file prometheus

       server {
          server_name prometheus.frenky.studentdumbways.my.id;

          location / {
             proxy_pass http://103.187.147.155:9090;
          }
       }

4. Buat file monitoring

       server {
          server_name monitoring.frenky.studentdumbways.my.id;

          location / {
             proxy_pass http://103.187.147.155:3000;
          }
       }

5. Buat file jenkins

       server {
          server_name jenkins.frenky.studentdumbways.my.id;

          location / {
             proxy_pass http://103.187.147.155:8080;
          }
       }

6. Buat file referse-proxy.yaml

         - hosts: all
           become: true
           vars:
             - ipapp: 103.189.234.3
           tasks:

             - name: "Copying prometheus.yaml"
               copy:
                 src: {{item}}
                 dest: /etc/nginx/sites-enabled/
               loop:
                - app
                - api
                - prometheus
                - monitoring
                - jenkins

             - name: Restarting nginx
               service:
                 name: nginx
                 state: restarted

             - name: install pip3
               apt: 
                 name: python3-pip
                 state: present

             - name: install certbot
               pip:
                 name:
                   - certbot
                   - certbot-nginx 
                 executable: pip3

             - name: Register certbot
               shell: |
                 certbot -n register --agree-tos --email kstones733@gmail.com
                 touch /etc/letsencrypt/.registered
               args:
                 creates: /etc/letsencrypt/.registered

             - name: Generate Certificate for domains
               command: '/usr/local/bin/certbot -n --nginx -d {{item}}'
               args:
                 creates: '/etc/letsencrypt/live/{{item}}'
               loop:
                - frenky.studentdumbways.my.id
                - api.frenky.studentdumbways.my.id
                - prometheus.frenky.studentdumbways.my.id
                - monitoring.frenky.studentdumbways.my.id
                - jenkins.frenky.studentdumbways.my.id

             - name: Restarting nginx
               service:
                 name: nginx
                 state: restarted

7. Jalankan Perintah berikut

       sudo ansible-playbook reverse-proxy.yaml













